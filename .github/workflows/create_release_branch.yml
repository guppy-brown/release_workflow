name: Create Release Branch

on: 
  workflow_dispatch:
  schedule:
  # every friday at AM11:00
    - cron: '0 2 * * 5'

jobs:
  create_release_branch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          ref: develop
          fetch-depth: 0
      â€“ name: Setup git config
        run: |
          git config user.name "GitHub Actions"
          git config user.email noreply@github.com
      - name: Install hub command
        run: |
          wget https://github.com/github/hub/releases/download/v2.14.2/hub-linux-amd64-2.14.2.tgz
          tar xzf hub-linux-amd64-2.14.2.tgz
          sudo ./hub-linux-amd64-2.14.2/install
      - name: Get current version
        id: get_cur_ver
        run: |
          ver=`git tag --sort=-v:refname | head -n 1 | cut -d"v" -f2`
          echo "::set-output name=version::${ver}"
      - name: Bump version
        id: bump_version
        uses: christian-draeger/increment-semantic-version@1.0.2
        with:
          current-version: ${{ steps.get_cur_ver.outputs.version }}
          version-fragment: 'feature'
      - name: Create Release Branch
        run: |
          new_version=v${{ steps.bump_version.outputs.next-version }}
          git checkout -b release/${new_version}
          git push origin release/${new_version}
      - name: Create History
        run: |
          git log --merges --pretty=format:'%s (@%an)' --date=relative main...release/${new_version}
